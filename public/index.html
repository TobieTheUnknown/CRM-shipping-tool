<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShipTrack - CRM Logistics</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- SIDEBAR -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">üì¶</div>
                    <div class="logo-text">ShipTrack</div>
                </div>
                <div class="logo-subtitle">Logistics CRM</div>
            </div>

            <nav class="nav">
                <div class="nav-item active" data-tab="colis">
                    <span class="nav-icon">üì¶</span>
                    <span>Colis en pr√©paration</span>
                    <span class="nav-badge" id="statPrepSidebar">0</span>
                </div>
                <div class="nav-item" data-tab="clients">
                    <span class="nav-icon">üë•</span>
                    <span>Clients</span>
                    <span class="nav-badge" id="statClientsSidebar">0</span>
                </div>
                <div class="nav-item" data-tab="produits">
                    <span class="nav-icon">üè∑Ô∏è</span>
                    <span>Produits</span>
                </div>
                <div class="nav-item" data-tab="timbres">
                    <span class="nav-icon">üé´</span>
                    <span>Timbres</span>
                    <span class="nav-badge" id="statTimbresSidebar">0</span>
                </div>
            </nav>

            <div class="nav-bottom">
                <div class="nav-item" data-tab="settings">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    <span>Param√®tres</span>
                </div>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-content">
            <!-- TAB SETTINGS -->
            <div id="tab-settings" class="tab-content">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">‚öôÔ∏è Param√®tres</h1>
                        <p class="page-subtitle">Configuration et gestion des donn√©es</p>
                    </div>
                </div>

                <!-- CONFIGURATION LOGO -->
                <div class="database-tools">
                    <h3>üñºÔ∏è Logo pour √âtiquettes</h3>
                    <p style="text-align: center; color: #666; margin-bottom: 15px;">
                        Logo affich√© sur les √©tiquettes d'exp√©dition (format horizontal recommand√©)
                    </p>
                    <div class="logo-upload-section">
                        <div id="logoPreview" class="logo-preview">
                            <img id="logoImage" src="" alt="Logo" style="display: none; max-width: 100%; max-height: 80px;">
                            <p id="logoPlaceholder">Aucun logo configur√©</p>
                        </div>
                        <div class="logo-actions">
                            <input type="file" id="logoFileInput" accept="image/png,image/jpeg,image/jpg" style="display: none;" onchange="uploadLogo()">
                            <button class="btn btn-primary" onclick="document.getElementById('logoFileInput').click()">
                                üì§ Choisir un logo
                            </button>
                            <button class="btn btn-danger" onclick="removeLogo()" id="btnRemoveLogo" style="display: none;">
                                üóëÔ∏è Supprimer le logo
                            </button>
                        </div>
                    </div>
                </div>

                <!-- GESTION DES DIMENSIONS -->
                <div class="database-tools">
                    <h3>üìê Dimensions de cartons</h3>
                    <p style="text-align: center; color: #666; margin-bottom: 15px;">
                        G√©rez les dimensions de cartons disponibles pour vos colis
                    </p>

                    <div class="dimensions-list" id="dimensionsList">
                        <!-- Liste des dimensions g√©n√©r√©e dynamiquement -->
                    </div>

                    <div class="dimension-form" id="dimensionForm">
                        <h4 id="dimensionFormTitle">Ajouter une dimension</h4>
                        <input type="hidden" id="dimensionId">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Nom</label>
                                <input type="text" id="dimensionNom" placeholder="Ex: Petit, Moyen...">
                            </div>
                            <div class="form-group">
                                <label>Longueur (cm)</label>
                                <input type="number" id="dimensionLongueur" step="0.1" min="0">
                            </div>
                            <div class="form-group">
                                <label>Largeur (cm)</label>
                                <input type="number" id="dimensionLargeur" step="0.1" min="0">
                            </div>
                            <div class="form-group">
                                <label>Hauteur (cm)</label>
                                <input type="number" id="dimensionHauteur" step="0.1" min="0">
                            </div>
                            <div class="form-group">
                                <label>Poids carton (kg)</label>
                                <input type="number" id="dimensionPoidsCarton" step="0.01" min="0" placeholder="0.00">
                            </div>
                        </div>
                        <div class="tools-buttons" style="margin-top: 15px;">
                            <button class="btn btn-primary" onclick="saveDimension()">
                                üíæ Enregistrer
                            </button>
                            <button class="btn btn-secondary" onclick="cancelDimensionEdit()" id="btnCancelDimension" style="display: none;">
                                Annuler
                            </button>
                        </div>
                    </div>
                </div>

                <!-- GESTION DES CAT√âGORIES DE TIMBRES -->
                <div class="database-tools">
                    <h3>üé´ Cat√©gories de timbres</h3>
                    <p style="text-align: center; color: #666; margin-bottom: 15px;">
                        G√©rez les types de timbres disponibles (national, international, etc.)
                    </p>

                    <div class="dimensions-list" id="timbreCategoriesList">
                        <!-- Liste des cat√©gories g√©n√©r√©e dynamiquement -->
                    </div>

                    <div class="dimension-form" id="timbreCategorieForm">
                        <h4 id="timbreCategorieFormTitle">Ajouter une cat√©gorie</h4>
                        <input type="hidden" id="timbreCategorieId">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Nom</label>
                                <input type="text" id="timbreCategorieNom" placeholder="Ex: International 100g">
                            </div>
                            <div class="form-group">
                                <label>Type</label>
                                <select id="timbreCategorieType">
                                    <option value="national">National</option>
                                    <option value="international">International</option>
                                    <option value="autre">Autre</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Poids min (g)</label>
                                <input type="number" id="timbreCategoriePoidsMin" step="1" min="0" placeholder="0">
                            </div>
                            <div class="form-group">
                                <label>Poids max (g)</label>
                                <input type="number" id="timbreCategoriePoidsMax" step="1" min="0" placeholder="100">
                            </div>
                        </div>
                        <div class="tools-buttons" style="margin-top: 15px;">
                            <button class="btn btn-primary" onclick="saveTimbreCategorie()">
                                üíæ Enregistrer
                            </button>
                            <button class="btn btn-secondary" onclick="cancelTimbreCategorieEdit()" id="btnCancelTimbreCategorie" style="display: none;">
                                Annuler
                            </button>
                        </div>
                    </div>
                </div>

                <!-- IMPORT CSV -->
                <div class="database-tools">
                    <h3>üìã Import CSV</h3>
                    <p style="text-align: center; color: #666; margin-bottom: 15px;">
                        Importez vos colis en masse via un fichier CSV
                    </p>

                <div class="csv-upload-section">
                    <div class="upload-card">
                        <div class="upload-icon">üìÑ</div>
                        <h3>Format CSV attendu</h3>
                        <p style="margin-bottom: 16px; color: var(--text-secondary);">Colonnes requises :</p>
                        <ul class="csv-columns">
                            <li><strong>Item</strong> - Nom de l'article</li>
                            <li><strong>Lien</strong> - Lien vers l'article</li>
                            <li><strong>Prix Objet (‚Ç¨)</strong> - Prix en euros</li>
                            <li><strong>Poids (kg)</strong> - Poids du colis</li>
                            <li><strong>Adresse d'envoi</strong> - Adresse compl√®te</li>
                            <li><strong>Lien de suivi colis</strong> - Num√©ro de suivi</li>
                            <li><strong>Photos/Vid√©os associ√©es</strong> - Liens m√©dias</li>
                            <li><strong>Statut</strong> - √âtat du colis</li>
                            <li><strong>Timestamp</strong> - Date de cr√©ation</li>
                            <li><strong>N¬∞ Colis/mois</strong> - R√©f√©rence</li>
                            <li><strong>Note</strong> - Notes additionnelles</li>
                        </ul>
                    </div>

                    <div class="upload-card">
                        <h3>üì§ Importer votre fichier</h3>
                        <form id="csvUploadForm" onsubmit="uploadCSV(event)">
                            <div class="file-input-wrapper">
                                <input type="file" id="csvFile" accept=".csv" required>
                                <label for="csvFile" class="file-label">
                                    <span id="fileNameDisplay">Choisir un fichier CSV...</span>
                                </label>
                            </div>
                            <button type="submit" class="btn btn-primary btn-large" id="uploadBtn">
                                ‚¨ÜÔ∏è Importer le CSV
                            </button>
                        </form>

                        <div id="importResult" class="import-result" style="display: none;">
                            <h4>R√©sultat de l'import</h4>
                            <div id="importResultContent"></div>
                        </div>
                    </div>
                </div>

                <div class="csv-example">
                    <button class="btn btn-secondary" onclick="downloadExampleCSV()">
                        üíæ T√©l√©charger un mod√®le CSV
                    </button>
                </div>
                </div>

                <!-- EXPORT/IMPORT DONN√âES -->
                <div class="database-tools">
                    <h3>üíæ Export / Import de donn√©es</h3>
                    <p style="text-align: center; color: #666; margin-bottom: 15px;">
                        Exportez ou importez l'ensemble de vos donn√©es (clients, produits, colis)
                    </p>
                    <div class="tools-buttons">
                        <button class="btn btn-success" onclick="exportDatabase()">
                            üíæ Exporter toutes les donn√©es
                        </button>
                        <input type="file" id="dbImportFile" accept=".db" style="display: none;" onchange="importDatabase()">
                        <button class="btn btn-secondary" onclick="document.getElementById('dbImportFile').click()">
                            üì• Importer des donn√©es
                        </button>
                    </div>
                    <p style="text-align: center; color: #ff6b6b; font-size: 12px; margin-top: 10px;">
                        ‚ö†Ô∏è L'import remplacera toutes les donn√©es actuelles
                    </p>
                </div>

                <!-- OUTILS BASE DE DONN√âES -->
                <div class="database-tools">
                    <h3>üõ†Ô∏è Outils de base de donn√©es</h3>
                    <div class="tools-buttons">
                        <button class="btn btn-success" onclick="initTestData()">
                            üé≤ Charger des donn√©es de test
                        </button>
                        <button class="btn btn-danger" onclick="resetDatabase()">
                            üóëÔ∏è R√©initialiser la base de donn√©es
                        </button>
                    </div>
                    <div id="dbToolsResult" class="import-result" style="display: none;">
                        <div id="dbToolsResultContent"></div>
                    </div>
                </div>
            </div>

            <!-- TAB COLIS -->
            <div id="tab-colis" class="tab-content active">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Gestion des Colis</h1>
                        <p class="page-subtitle">Suivi et gestion de vos envois</p>
                    </div>
                </div>

                <div class="actions-bar">
                    <div class="search-bar">
                        <input type="text" id="searchColis" placeholder="üîç Rechercher par client, produit, pays, ville, lien, n¬∞ de suivi..." oninput="filterColis()">
                    </div>
                    <button class="btn btn-primary" onclick="showAddColisModal()">+ Nouveau Colis</button>
                    <button class="btn btn-success" onclick="imprimerEtiquettesSelection()" id="btnImprimerSelection" disabled>
                        üñ®Ô∏è Imprimer √âtiquettes (<span id="selectedCount">0</span>)
                    </button>
                </div>

                <!-- COLIS EN PR√âPARATION -->
                <div class="colis-section">
                    <h3 class="section-title">
                        <span>üì¶ En pr√©paration</span>
                        <span class="section-count" id="countEnPreparation">0</span>
                    </h3>
                    <div class="table-container">
                        <table class="colisTable">
                            <thead>
                                <tr>
                                    <th><input type="checkbox" class="select-all" onchange="toggleSelectAll('preparation')"></th>
                                    <th>Date</th>
                                    <th>Produit</th>
                                    <th>Client / Adresse</th>
                                    <th>Statut</th>
                                    <th>Poids</th>
                                    <th>N¬∞ Suivi</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="colisEnPreparationBody">
                                <tr><td colspan="8" class="empty">Aucun colis en pr√©paration</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- COLIS PROBL√âMATIQUES (Out of stock / Incomplet) -->
                <div class="colis-section">
                    <h3 class="section-title" style="color: var(--accent-orange);">
                        <span>‚ö†Ô∏è Probl√©matiques</span>
                        <span class="section-count" id="countProblematiques">0</span>
                    </h3>
                    <div class="table-container">
                        <table class="colisTable">
                            <thead>
                                <tr>
                                    <th><input type="checkbox" class="select-all" onchange="toggleSelectAll('problematiques')"></th>
                                    <th>Date</th>
                                    <th>Produit</th>
                                    <th>Client / Adresse</th>
                                    <th>Statut</th>
                                    <th>Poids</th>
                                    <th>N¬∞ Suivi</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="colisProblematiquesBody">
                                <tr><td colspan="8" class="empty">Aucun colis probl√©matique</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- COLIS ENVOY√âS -->
                <div class="colis-section">
                    <h3 class="section-title collapsible" onclick="toggleSection('expedies')">
                        <span>üì´ Colis envoy√©s</span>
                        <span style="display: flex; align-items: center; gap: 12px;">
                            <span class="section-count" id="countExpedies">0</span>
                            <span class="toggle-icon" id="toggleExpedies">‚ñº</span>
                        </span>
                    </h3>
                    <div class="table-container" id="sectionExpedies">
                        <table class="colisTable">
                            <thead>
                                <tr>
                                    <th><input type="checkbox" class="select-all" onchange="toggleSelectAll('expedies')"></th>
                                    <th>Date</th>
                                    <th>Produit</th>
                                    <th>Client / Adresse</th>
                                    <th>Statut</th>
                                    <th>Poids</th>
                                    <th>N¬∞ Suivi</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="colisExpediesBody">
                                <tr><td colspan="8" class="empty">Aucun colis envoy√©</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- TAB CLIENTS -->
            <div id="tab-clients" class="tab-content">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Clients</h1>
                        <p class="page-subtitle">Gestion de votre base clients</p>
                    </div>
                </div>

                <div class="actions-bar">
                    <div class="search-bar">
                        <input type="text" id="searchClients" placeholder="üîç Rechercher un client..." oninput="filterClients()">
                    </div>
                    <button class="btn btn-primary" onclick="showAddClientModal()">+ Nouveau Client</button>
                    <button class="btn btn-success" onclick="showMergeClientsModal()" id="btnMergeClients" style="display: none;">
                        üîÄ Fusionner (<span id="selectedClientsCount">0</span>)
                    </button>
                </div>

                <div class="table-container">
                    <table id="clientsTable">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selectAllClients" onchange="toggleSelectAllClients()"></th>
                                <th>Pseudo</th>
                                <th>Nom</th>
                                <th>Pr√©nom</th>
                                <th>Email</th>
                                <th>T√©l√©phone</th>
                                <th>Ville</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="clientsTableBody">
                            <tr><td colspan="8" class="empty">Aucun client</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- TAB PRODUITS -->
            <div id="tab-produits" class="tab-content">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Produits</h1>
                        <p class="page-subtitle">Catalogue de produits</p>
                    </div>
                </div>

                <div class="actions-bar">
                    <div class="search-bar">
                        <input type="text" id="searchProduits" placeholder="üîç Rechercher un produit..." oninput="filterProduits()">
                    </div>
                    <button class="btn btn-primary" onclick="showAddProduitModal()">+ Nouveau Produit</button>
                    <button class="btn btn-success" onclick="showMergeProduitsModal()" id="btnMergeProduits" style="display: none;">
                        üîÄ Fusionner (<span id="selectedProduitsCount">0</span>)
                    </button>
                </div>

                <div class="table-container">
                    <table id="produitsTable">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selectAllProduits" onchange="toggleSelectAllProduits()"></th>
                                <th>Nom</th>
                                <th>R√©f.</th>
                                <th>Description</th>
                                <th>Prix</th>
                                <th>Poids</th>
                                <th>Stock</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="produitsTableBody">
                            <tr><td colspan="8" class="empty">Aucun produit</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- TAB TIMBRES -->
            <div id="tab-timbres" class="tab-content">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">üé´ Timbres</h1>
                        <p class="page-subtitle">Gestion des num√©ros de suivi La Poste</p>
                    </div>
                </div>

                <!-- Import de timbres -->
                <div class="database-tools" style="margin-bottom: 24px;">
                    <h3>üì• Importer des timbres</h3>
                    <div class="form-row" style="margin-bottom: 15px;">
                        <div class="form-group">
                            <label>Cat√©gorie de poids</label>
                            <select id="timbrePoidsCategorie" onchange="updateTimbrePoidsRange()">
                                <option value="0-20" data-min="0" data-max="20">Moins de 20g</option>
                                <option value="21-100" data-min="21" data-max="100">21g - 100g</option>
                                <option value="101-250" data-min="101" data-max="250">101g - 250g</option>
                                <option value="251-500" data-min="251" data-max="500">251g - 500g</option>
                                <option value="501-1000" data-min="501" data-max="1000">501g - 1kg</option>
                                <option value="1001-2000" data-min="1001" data-max="2000">1kg - 2kg</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Coller les num√©ros de suivi (format SD: XXXXX)</label>
                        <textarea id="timbresImportText" rows="8" placeholder="Collez ici les num√©ros de suivi...&#10;Exemple:&#10;SD: 870013291334738&#10;870013291334738&#10;√Ä t√©l√©charger&#10;SD: 870013291334746&#10;..."></textarea>
                    </div>
                    <div class="form-actions" style="border-top: none; padding-top: 0; margin-top: 10px;">
                        <button type="button" class="btn btn-primary" onclick="importTimbres()">
                            üì• Importer les timbres
                        </button>
                    </div>
                </div>

                <!-- Liste des timbres par cat√©gorie -->
                <div id="timbresListContainer">
                    <!-- G√©n√©r√© dynamiquement -->
                </div>
            </div>
        </main>
    </div>

    <!-- MODAL AJOUT CLIENT -->
    <div id="modalClient" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('modalClient')">&times;</span>
            <h2>Nouveau Client</h2>

            <!-- Option de remplissage automatique -->
            <div style="margin-bottom: 20px; padding: 10px; background: #f0f7ff; border-radius: 8px;">
                <button type="button" class="btn btn-secondary btn-small" onclick="toggleQuickFillClient()" style="width: 100%;">
                    üîç Remplissage automatique (coller des infos en vrac)
                </button>
                <div id="quickFillClientSection" style="display: none; margin-top: 15px;">
                    <textarea id="quickFillClientInput" rows="6" placeholder="Collez les infos du client ici...&#10;Exemple:&#10;John Doe&#10;123 Main Street&#10;75001 Paris, France&#10;john.doe@example.com&#10;0601020304" style="width: 100%; font-family: monospace; font-size: 13px; padding: 10px; border: 1px solid #ddd; border-radius: 5px;"></textarea>
                    <button type="button" class="btn btn-primary btn-small" onclick="parseAndFillClientForm()" style="margin-top: 10px;">
                        ‚ú® Analyser et remplir les champs
                    </button>
                </div>
            </div>

            <form id="formClient" onsubmit="saveClient(event)">
                <input type="hidden" id="clientId">
                <div class="form-group">
                    <label>Pseudo / Surnom</label>
                    <input type="text" id="clientPseudo" placeholder="Ex: TechCollector42">
                </div>
                <div class="form-group">
                    <label>Nom *</label>
                    <input type="text" id="clientNom" required>
                </div>
                <div class="form-group">
                    <label>Pr√©nom</label>
                    <input type="text" id="clientPrenom">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="clientEmail">
                </div>
                <div class="form-group">
                    <label>T√©l√©phone</label>
                    <input type="tel" id="clientTelephone">
                </div>
                <div class="form-group">
                    <label>Adresse</label>
                    <input type="text" id="clientAdresse">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Code Postal</label>
                        <input type="text" id="clientCodePostal">
                    </div>
                    <div class="form-group">
                        <label>Ville</label>
                        <input type="text" id="clientVille">
                    </div>
                </div>
                <div class="form-group">
                    <label>Pays</label>
                    <input type="text" id="clientPays" value="France">
                </div>

                <h3>Wallets</h3>
                <div id="walletsContainer"></div>
                <button type="button" class="btn btn-secondary btn-small" onclick="addWalletField()">+ Ajouter un wallet</button>

                <h3>Liens externes</h3>
                <div id="liensContainer"></div>
                <button type="button" class="btn btn-secondary btn-small" onclick="addLienField()">+ Ajouter un lien</button>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('modalClient')">Annuler</button>
                    <button type="submit" class="btn btn-primary">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL D√âTAILS CLIENT -->
    <div id="modalClientDetails" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('modalClientDetails')">&times;</span>
            <h2>D√©tails du Client</h2>
            <div id="clientDetailsContent"></div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('modalClientDetails')">Fermer</button>
                <button type="button" class="btn btn-primary" onclick="editClientFromDetails()">‚úèÔ∏è √âditer</button>
            </div>
        </div>
    </div>

    <!-- MODAL AJOUT PRODUIT -->
    <div id="modalProduit" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('modalProduit')">&times;</span>
            <h2>Nouveau Produit</h2>
            <form id="formProduit" onsubmit="saveProduit(event)">
                <input type="hidden" id="produitId">
                <div class="form-group">
                    <label>Nom *</label>
                    <input type="text" id="produitNom" required>
                </div>
                <div class="form-group">
                    <label>R√©f√©rence</label>
                    <input type="text" id="produitRef" placeholder="Ex: GOLD-2.5G, WATCH-001">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="produitDescription" rows="3"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Prix (‚Ç¨)</label>
                        <input type="number" step="0.01" id="produitPrix">
                    </div>
                    <div class="form-group">
                        <label>Poids (kg)</label>
                        <input type="number" step="0.01" id="produitPoids">
                    </div>
                    <div class="form-group">
                        <label>Stock</label>
                        <input type="number" id="produitStock" value="0">
                    </div>
                </div>
                <div class="form-group">
                    <label>Dimension par d√©faut (optionnel)</label>
                    <select id="produitDimensionId">
                        <option value="">Aucune dimension par d√©faut</option>
                        <!-- Options g√©n√©r√©es dynamiquement -->
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('modalProduit')">Annuler</button>
                    <button type="submit" class="btn btn-primary">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL AJOUT COLIS -->
    <div id="modalColis" class="modal">
        <div class="modal-content modal-large">
            <span class="close" onclick="closeModal('modalColis')">&times;</span>
            <h2>Nouveau Colis</h2>
            <form id="formColis" onsubmit="saveColis(event)">
                <input type="hidden" id="colisId">

                <div class="form-row">
                    <div class="form-group" style="flex: 1;">
                        <label>Client *</label>
                        <div style="display: flex; gap: 8px;">
                            <div class="client-search-container" style="flex: 1; position: relative;">
                                <input type="hidden" id="colisClientId" required>
                                <input
                                    type="text"
                                    id="clientSearchInput"
                                    placeholder="üîç Rechercher un client (nom, pr√©nom, pseudo)..."
                                    autocomplete="off"
                                    oninput="filterClientDropdown()"
                                    onfocus="showClientDropdown()"
                                    style="width: 100%;"
                                >
                                <div id="clientDropdown" class="client-dropdown" style="display: none;">
                                    <!-- Options g√©n√©r√©es dynamiquement -->
                                </div>
                            </div>
                            <button type="button" class="btn btn-secondary btn-small" onclick="showQuickClientModal()" title="Cr√©er un client rapidement">
                                ‚ûï Cr√©er
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>N¬∞ de Suivi <span id="timbreInfo" style="font-size: 11px; color: var(--accent-green);"></span></label>
                        <input type="hidden" id="selectedTimbreId">
                        <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                            <select id="colisTimbreCategorie" onchange="updateTimbreSelect()" style="width: 140px;">
                                <option value="">Cat√©gorie...</option>
                                <option value="0-20">Moins de 20g</option>
                                <option value="21-100">21g - 100g</option>
                                <option value="101-250">101g - 250g</option>
                                <option value="251-500">251g - 500g</option>
                                <option value="501-1000">501g - 1kg</option>
                                <option value="1001-2000">1kg - 2kg</option>
                            </select>
                            <select id="colisTimbreSelect" onchange="selectTimbreFromDropdown()" style="flex: 1; min-width: 150px;">
                                <option value="">S√©lectionner un timbre...</option>
                            </select>
                            <a id="lienSuiviBtn" href="#" target="_blank" class="btn btn-secondary btn-small" style="display: none; white-space: nowrap;">
                                üîó Suivre
                            </a>
                        </div>
                        <input type="text" id="colisNumeroSuivi" placeholder="Ou saisir manuellement..." oninput="updateLienSuiviPreview()" style="margin-top: 8px;">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Statut</label>
                        <select id="colisStatut">
                            <option value="En pr√©paration">En pr√©paration</option>
                            <option value="Out of stock">Out of stock</option>
                            <option value="Envoy√©">Envoy√©</option>
                            <option value="Incomplet">Incomplet</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Poids (kg)</label>
                        <input type="number" step="0.01" id="colisPoids">
                    </div>
                    <div class="form-group">
                        <label>R√©f√©rence (calcul√©e auto.)</label>
                        <input type="text" id="colisReference" placeholder="Ajoutez des produits..." readonly style="background: rgba(255,255,255,0.05); cursor: not-allowed;">
                    </div>
                </div>

                <div class="form-group">
                    <label>Dimensions</label>
                    <input type="text" id="colisDimensions" placeholder="Ex: 30x20x15cm" readonly>
                    <div class="dimension-buttons" id="dimensionButtons">
                        <!-- Dimensions g√©n√©r√©es dynamiquement -->
                    </div>
                </div>

                <h3>Produits du stock</h3>
                <p style="color: #666; font-size: 13px; margin-bottom: 10px;">
                    S√©lectionnez les produits √† inclure dans ce colis (le stock sera automatiquement d√©cr√©ment√©)
                </p>
                <div id="colisProduitsContainer" class="colis-produits-container">
                    <!-- Produits ajout√©s dynamiquement -->
                </div>
                <div class="form-group" style="margin-top: 10px;">
                    <label>Ajouter un produit</label>
                    <div class="produit-search-container">
                        <input type="text" id="searchProduitsColis" placeholder="üîç Rechercher un produit..." oninput="filterProduitsForColis()">
                        <div id="produitSearchResults" class="produit-search-results" style="display: none;">
                            <!-- R√©sultats de recherche g√©n√©r√©s dynamiquement -->
                        </div>
                    </div>
                    <button type="button" class="btn btn-secondary btn-small" onclick="showQuickAddProduitModal()" style="margin-top: 8px;">
                        + Cr√©er un nouveau produit
                    </button>
                </div>
                <h3>Adresse d'exp√©dition</h3>
                <div class="form-group">
                    <label>Adresse (ligne 1)</label>
                    <input type="text" id="colisAdresse">
                </div>
                <div class="form-group">
                    <label>Adresse (ligne 2 - optionnel)</label>
                    <input type="text" id="colisAdresseLigne2" placeholder="B√¢timent, √©tage, compl√©ment...">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Code Postal</label>
                        <input type="text" id="colisCodePostal">
                    </div>
                    <div class="form-group">
                        <label>Ville</label>
                        <input type="text" id="colisVille">
                    </div>
                    <div class="form-group">
                        <label>Pays</label>
                        <input type="text" id="colisPays" value="France">
                    </div>
                </div>

                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="colisNotes" rows="3"></textarea>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('modalColis')">Annuler</button>
                    <button type="submit" class="btn btn-primary">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL CR√âATION RAPIDE CLIENT -->
    <div id="modalQuickClient" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('modalQuickClient')">&times;</span>
            <h2>Cr√©er un Client Rapidement</h2>
            <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
                Collez les informations du client (nom, adresse, email, t√©l√©phone) et elles seront automatiquement reconnues.
            </p>

            <div class="form-group">
                <label>Informations du client</label>
                <textarea id="quickClientInput" rows="8" placeholder="Exemple:&#10;John Doe&#10;123 Main Street&#10;75001 Paris, France&#10;john.doe@example.com&#10;0601020304" style="font-family: monospace; font-size: 13px;"></textarea>
            </div>

            <div style="text-align: center; margin: 15px 0;">
                <button type="button" class="btn btn-primary" onclick="parseQuickClient()">
                    üîç Analyser et pr√©-remplir
                </button>
            </div>

            <div id="parsedClientPreview" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 15px;">
                <h3 style="margin-top: 0; font-size: 14px; color: #666;">Aper√ßu des donn√©es d√©tect√©es:</h3>
                <div id="parsedClientData" style="font-size: 13px;"></div>

                <div class="form-actions" style="margin-top: 15px;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('modalQuickClient')">Annuler</button>
                    <button type="button" class="btn btn-primary" onclick="confirmQuickClient()">‚úì Cr√©er ce client</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL CR√âATION RAPIDE PRODUIT -->
    <div id="modalQuickProduit" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('modalQuickProduit')">&times;</span>
            <h2>Cr√©er un Produit Rapidement</h2>
            <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
                Remplissez les informations essentielles. Le produit sera automatiquement ajout√© au colis en cours.
            </p>
            <form id="formQuickProduit" onsubmit="saveQuickProduit(event)">
                <div class="form-group">
                    <label>Nom du produit *</label>
                    <input type="text" id="quickProduitNom" required placeholder="Ex: iPhone 13 Pro">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Poids (kg) *</label>
                        <input type="number" step="0.001" id="quickProduitPoids" required placeholder="0.200">
                    </div>
                    <div class="form-group">
                        <label>Prix (‚Ç¨)</label>
                        <input type="number" step="0.01" id="quickProduitPrix" placeholder="399.00">
                    </div>
                </div>
                <div class="form-group">
                    <label>Dimension du carton</label>
                    <select id="quickProduitDimension">
                        <option value="">Aucune</option>
                        <!-- Options g√©n√©r√©es dynamiquement -->
                    </select>
                </div>
                <div class="form-group">
                    <label>Stock initial *</label>
                    <input type="number" id="quickProduitStock" required value="0" placeholder="0">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="quickProduitDescription" rows="2" placeholder="Description optionnelle..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('modalQuickProduit')">Annuler</button>
                    <button type="submit" class="btn btn-primary">Cr√©er et ajouter au colis</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL PRODUITS DU COLIS -->
    <div id="modalColisProduits" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('modalColisProduits')">&times;</span>
            <h2>Produits du colis</h2>
            <div id="colisProduitsListModal" class="produits-list-modal">
                <!-- Liste des produits g√©n√©r√©e dynamiquement -->
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('modalColisProduits')">Fermer</button>
            </div>
        </div>
    </div>

    <!-- MODAL √âDITION TIMBRE -->
    <div id="modalEditTimbre" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('modalEditTimbre')">&times;</span>
            <h2>√âditer le timbre</h2>
            <form id="formEditTimbre" onsubmit="saveEditTimbre(event)">
                <input type="hidden" id="editTimbreId">
                <div class="form-group">
                    <label>N¬∞ de Suivi</label>
                    <input type="text" id="editTimbreNumero" required>
                </div>
                <div class="form-group">
                    <label>Cat√©gorie</label>
                    <select id="editTimbreCategorie" required onchange="updateEditTimbrePoidsRange()">
                        <!-- Options g√©n√©r√©es dynamiquement -->
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('modalEditTimbre')">Annuler</button>
                    <button type="submit" class="btn btn-primary">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL FUSION CLIENTS -->
    <div id="modalMergeClients" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('modalMergeClients')">&times;</span>
            <h2>üîÄ Fusionner les clients</h2>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                S√©lectionnez le client √† conserver. Tous les colis des autres clients seront transf√©r√©s vers celui-ci, puis les doublons seront supprim√©s.
            </p>
            <div id="mergeClientsPreview" class="merge-preview">
                <!-- Liste des clients s√©lectionn√©s g√©n√©r√©e dynamiquement -->
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('modalMergeClients')">Annuler</button>
                <button type="button" class="btn btn-primary" onclick="confirmMergeClients()" id="btnConfirmMergeClients" disabled>
                    üîÄ Fusionner les clients
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL FUSION PRODUITS -->
    <div id="modalMergeProduits" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('modalMergeProduits')">&times;</span>
            <h2>üîÄ Fusionner les produits</h2>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                S√©lectionnez le produit √† conserver. Toutes les relations colis-produits seront transf√©r√©es vers celui-ci, puis les doublons seront supprim√©s.
            </p>
            <div id="mergeProduitsPreview" class="merge-preview">
                <!-- Liste des produits s√©lectionn√©s g√©n√©r√©e dynamiquement -->
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('modalMergeProduits')">Annuler</button>
                <button type="button" class="btn btn-primary" onclick="confirmMergeProduits()" id="btnConfirmMergeProduits" disabled>
                    üîÄ Fusionner les produits
                </button>
            </div>
        </div>
    </div>

    <!-- TOAST NOTIFICATIONS -->
    <div id="toastContainer" class="toast-container"></div>

    <script src="app.js"></script>
</body>
</html>
